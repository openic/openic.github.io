;(function(require,define,_,Backbone,ActiveXObject,require){ActiveXObject=window.ActiveXObject;;!function t(e,o,i){function n(s,a){if(!o[s]){if(!e[s]){var _="function"==typeof require&&require;if(!a&&_)return _(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=o[s]={exports:{}};e[s][0].call(c.exports,function(t){var o=e[s][1][t];return n(o?o:t)},c,c.exports,t,e,o,i)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(){olark.declare({name:"Cobrowsing",version:"1.0",startup:function(t,e){function o(t){return e.locale.hasOwnProperty(t)&&e.locale[t]?e.locale[t]:d.hasOwnProperty(t)?d[t]:"MISSING TRANSLATION: "+t}function i(t){return hbl.util.encode_html_entities(o(t))}function n(t){var e=this;t=t||{},this._api=t.legacyOlarkAPI,this._win=t.window||window,this._doc=this._win.document,this._accountToken=t.accountToken,this._apiToken=t.apiToken,this._libraryURL=t.libraryURL,this._silent=t.silent,this._maskedSelectors=t.maskedSelectors,this._showSecureElements=t.showSecureElements,this._conversationId=t.conversationId,this._calls=[],this._fireflyLoadTimeout=null,this._didTimeout=!1,this._currentSessionName=this._api.data.getConversationObject({key:"currentSessionName"}),this._currentSessionName.get()||this._currentSessionName.set((new Date).getTime()),this._connectionTimer=null,this._connecting=!1,this._waitingForAccept=!1,this._active=this._api.data.getConversationObject({key:"active"}),this._active.get()&&this._ensureFireflyIsAvailable(),this._declined=this._api.data.getConversationObject({key:"declined"}),this._ended=this._api.data.getConversationObject({key:"ended"}),this._lastURL=this._api.data.getConversationObject({key:"lastURL"}),this._operatorName=null,this._api.chat.onMessageToVisitor(function(t){e._operatorName=t.message.nickname}),this.on("cobrowsingEnded",function(){e._notifyOperator(o("cobrowsing_notify_operator_end_text")),e._notifyVisitor(i("cobrowsing_notify_visitor_end_text")),e._clearConnection()}),this.on("repControlRequested",function(){if(e._silent)e.grantRepControl(!0);else{var t=window.confirm(o("cobrowsing_confirm_control_text"));t&&e._notifyVisitor(i("cobrowsing_notify_visitor_control_text")),e.grantRepControl(t)}}),this.set("theme","black"),this.set("whitelabel",!0),this._maskSecureFields(),this._api.chat.__SPI_onInterfaceElementReady(function(t){e._populateInterface(t.key,t.dom)}),this._api.chat.__SPI_onEndedStateChanged(function(){e._active.get()&&e._endSession()})}var r="507dd5f988a1113547000001",s="507dd5f985dbad354701c5b6",a="https://firefly-071591.s3.amazonaws.com/scripts/loaders/loader.js",_=15e3,c=15e3,l=["on","set","start","startAPI","grantRepControl"],d={cobrowsing_notify_visitor_end_text:"Cobrowsing has ended.",cobrowsing_confirm_control_text:"Would you like the operator to take control of your browser?",cobrowsing_notify_visitor_control_text:"The operator is now controlling your browser.",cobrowsing_visitor_confirm_allow_message:"Do you want to allow the operator to view your browser window?",cobrowsing_visitor_confirm_allow_button_start:"Start sharing.",cobrowsing_visitor_confirm_allow_button_decline:"Decline.",cobrowsing_visitor_allow_approve_message:"You're now sharing your browser.",cobrowsing_allow_approve_button_stop:"End sharing.",cobrowsing_notify_visitor_decline_text:"Cobrowsing declined.",cobrowsing_notify_visitor_browser_not_supported:"We are sorry, but it looks like your internet browser does not support cobrowsing. Cobrowsing is currently only available in modern browsers.",cobrowsing_notify_operator_browser_not_supported:"We are sorry, but it looks like the visitor's internet browser does not support cobrowsing. Cobrowsing is currently only available in modern browsers.",cobrowsing_notify_operator_end_text:"Visitor has ended cobrowsing.",cobrowsing_notify_operator_decline_text:"The visitor has declined the cobrowse session.",cobrowsing_notify_operator_slow_connection_text:"Looks like connecting with the browser is going slowly, please contact us if this happens often",cobrowsing_notify_operator_start_conversation_text:"Please start a conversation before requesting to share the visitors browser window.",cobrowsing_notify_operator_share_link_text:"See what they see",cobrowsing_notify_operator_waiting_to_accept_text:"Waiting for visitor to accept cobrowsing...",cobrowsing_notify_operator_connecting_text:"Connecting with the visitor's browser...",cobrowsing_notify_operator_decline_share_text:"The visitor declined the cobrowsing session.",cobrowsing_notify_operator_unable_to_start_text:"Unable to start cobrowsing session, please contact us if this happens often"};!function(e){for(var n in l)!function(t){e[t]=function(){this._calls.push({method:t,args:arguments}),this._dequeueCalls()}}(l[n]);e._isSupported=function(){return window.document.querySelector&&window.document.querySelectorAll},e.debug=function(t){return this._debugMode=t,this._debugMode},e.share=function(){t.chat.__SPI_isConversing()||this._debugMode?(this._declined.set(!1),this._ended.set(!1),this._ensureSharing(),this._debugMode&&this._startSharing()):this._notifyOperator(o("cobrowsing_notify_operator_start_conversation_text"))},e._ensureSharing=function(){return this._ensureFireflyIsAvailable(),this._lastURL.get()?void this._notifyOperator(o("cobrowsing_notify_operator_share_link_text")+" ==> "+this._lastURL.get()):void(this._isSupported()?(this._notifyOperator(o("cobrowsing_notify_operator_waiting_to_accept_text")),this._waitingForAccept||(this._waitingForAccept=!0,this._createInterface("confirmation-box-"+this._currentSessionName.get()))):(olark._.hlog("#cobrowsing_not_supported"),this._notifyOperator(o("cobrowsing_notify_operator_browser_not_supported")),this._notifyVisitor(i("cobrowsing_notify_visitor_browser_not_supported"))))},e._startSharing=function(){var t=this;this._ensureFireflyIsAvailable(),this._currentSessionName.set((new Date).getTime()),this._notifyOperator(o("cobrowsing_notify_operator_connecting_text")),this._startConnection();try{var e={suppressUI:!0,partnerSessionID:this._conversationId};this.start(this._apiToken,e,function(e){var i=(new Date).getTime()-t._startConnectionTime;if(olark._.hlog("#cobrowsing_session_starting"),t._clearConnection(),t._active.set(!0),e){var n=e.replace(/.*olark\.usefirefly\.com\//,"https://static.olark.com/view/#");t._notifyOperator(o("cobrowsing_notify_operator_share_link_text")+" ==> "+n),t._lastURL.set(e),t._createInterface("cobrowse-terminate-"+t._currentSessionName.get()),olark._.hlog("#cobrowsing_session_started"),olark._.hlog("#cobrowsing_connection_time="+i),t._debugMode&&console.log("[olark] Cobrowsing connected in",i,"ms")}else t._notifyOperator(o("cobrowsing_notify_operator_decline_share_text"))})}catch(i){window.console&&window.console.warn&&(window.console.warn("[olark] unable to start cobrowsing session: "+i),olark._.hlog("#cobrowsing_exception "+i)),this._notifyOperator(o("cobrowsing_notify_operator_unable_to_start_text")+": beta+cobrowsing@olark.com")}},e._notifyOperator=function(t){this._debugMode?window.console&&console.info&&console.info("[cobrowse] would have notified operator:",t):this._api.chat.sendNotificationToOperator({body:t})},e._notifyVisitor=function(t){this._api.chat.sendNotificationToVisitor({body:t})},e._createInterface=function(t){this._api.chat.__SPI_sendInterfaceElementToVisitor({key:t})},e._populateInterface=function(t,e){var o=this,n=t.split("-").pop();switch(!0){case/^confirmation\-box\-/i.test(t):e.innerHTML=i("cobrowsing_visitor_confirm_allow_message")+" <span style='display:block;text-align:right;'><button data-action='start'>"+i("cobrowsing_visitor_confirm_allow_button_start")+"</button><button data-action='decline'>"+i("cobrowsing_visitor_confirm_allow_button_decline")+"</button></span>";for(var r=e.querySelectorAll("button"),s=function(){for(var t=0;t<r.length;t++)r[t].disabled=!0},a=0;a<r.length;a++){var _=r[a];(o._declined.get()||o._active.get()||o._ended.get())&&(_.disabled=!0),n!=o._currentSessionName.get()&&(_.disabled=!0),_.onclick=function(t){t=t||window.event;var e=t.target||t.srcElement,i=e.attributes["data-action"].value;"start"===i?o._lastURL.get()||o._handleConfirmation.apply(o,[t]):o._handleDecline.apply(o,[t]),s()}}break;case/^cobrowse\-terminate\-/i.test(t):e.innerHTML=i("cobrowsing_visitor_allow_approve_message")+"<span style='display:block;text-align:right;'><button>"+i("cobrowsing_allow_approve_button_stop")+"</button></span>";var c=e.querySelector("button");!this._declined.get()&&this._active.get()&&this._ended.get()||(c.disabled=!0),n!=o._currentSessionName.get()&&(c.disabled=!0),c.onclick=function(t){t=t||window.event;var e=t.target||t.srcElement;o._handleStop.apply(o,[t]),e.disabled=!0}}},e._handleConfirmation=function(){return olark._.hlog("#cobrowsing_session_requested"),this._waitingForAccept=!1,this._startSharing(),!1},e._handleDecline=function(){return olark._.hlog("#cobrowsing_session_declined"),this._waitingForAccept=!1,this._notifyOperator(o("cobrowsing_notify_operator_decline_text")),this._notifyVisitor(i("cobrowsing_notify_visitor_decline_text")),this._declined.set(!0),this._currentSessionName.set((new Date).getTime()),!1},e._handleStop=function(){return olark._.hlog("#cobrowsing_session_stopped"),this._endSession(),!1},e._endSession=function(){var t=this._firefly();t&&this._active.get()&&(t.endSession(),this._clearConnection())},e._ensureFireflyIsAvailable=function(){var t=this._firefly();if(!t||t.token!==this._accountToken&&!t.hasOwnProperty("ready")){window.fireflyAPI={token:this._accountToken,ready:function(t){"function"==typeof t&&(t=[t]);var e=null;if(window.fireflyAPI.onLoaded=window.fireflyAPI.onLoaded||[],window.fireflyAPI.isLoaded)for(e in t)t.hasOwnProperty(e)&&t[e]();else for(e in t)t.hasOwnProperty(e)&&window.fireflyAPI.onLoaded.push(t[e])}};var e=this._doc.createElement("script");e.type="text/javascript",e.src=this._libraryURL,e.async=!0;var o=this._doc.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o);var i=this;this._fireflyLoadTimeout=setTimeout(function(){i._checkFireflyHasLoaded()},c),this._startLoadTime=(new Date).getTime(),this._firefly().ready(function(){i._checkFireflyHasLoaded()})}},e._firefly=function(){return window.fireflyAPI},e._ready=function(){var t=this._firefly();return t&&t.start?!0:!1},e._dequeueCalls=function(){if(this._ready())for(var t=this._firefly();this._calls.length;){var e=this._calls.shift();t[e.method].apply(t,e.args)}},e._checkFireflyHasLoaded=function(){if(this._ready()){var t=(new Date).getTime()-this._startLoadTime;if(olark._.hlog("#cobrowsing_load_time="+t),this._debugMode&&console.log("[olark] Cobrowsing API loaded in",t,"ms"),this._didTimeout)olark._.hlog("#cobrowsing_loaded_after_timeout");else if(clearTimeout(this._fireflyLoadTimeout),this._debugMode){var e=this;setTimeout(function(){e._dequeueCalls()},1)}else this._dequeueCalls()}else this._didTimeout=!0,window.console&&window.console.warn&&window.console.warn("[olark] unable to load cobrowsing javascript"),olark._.hlog("#cobrowsing_not_loaded"),this._notifyOperator(o("cobrowsing_notify_operator_unable_to_start_text")+": support@olark.com")},e._startConnection=function(){function t(){e._connecting&&(e._notifyOperator(o("cobrowsing_notify_operator_slow_connection_text")+": beta+cobrowsing@olark.com"),e._clearConnection(),olark._.hlog("#cobrowsing_session_timeout"))}var e=this;this._connecting=!0,this._startConnectionTime=(new Date).getTime(),this._connectionTimer=setTimeout(t,_)},e._clearConnection=function(){this._connecting=!1,clearTimeout(this._connectionTimer),this._connectionTimer=null,this._lastURL.set(null),this._active.set(!1),this._declined.set(!1),this._ended.set(!0)},e._forEachDomElement=function(t,e){for(var o=document.querySelectorAll(t),i=0;i<o.length;i++)e(o[i])},e._maskSecureFields=function(){function t(t,e){var o=e.toLowerCase(),i=e.toUpperCase(),n=e.replace(/([^a-z0-9]|\b)([a-z0-9])/gi,function(t,e,o){return e+o.toUpperCase()});return["["+t+"*="+o+"]","["+t+"*="+i+"]","["+t+"*="+n+"]"].join(",")}var e=this._maskedSelectors;e=e.concat([t("name","Ecom_Payment"),t("name","credit_card"),t("name","creditcard"),t("type","hidden"),t("type","password"),t("name","hidden"),t("name","password"),t("name","secret"),t("name","auth"),t("name","token")]),this._showSecureElements&&this._forEachDomElement(e.join(","),function(t){t.style.boxShadow="0 0 8px yellow"}),this.set("masking",{"*":e})}}(n.prototype);var h=new window.olark.__core.BrowserTab({idStorageKey:"olark.activeBrowserTab"}),f=new n({legacyOlarkAPI:t,accountToken:e.system.firefly_account_token||s,apiToken:e.system.firefly_api_token||r,libraryURL:e.system.firefly_library_url||a,silent:e.system.prompt_visitor_for_cobrowsing||!1,maskedSelectors:e.system.masked_selectors_for_cobrowsing||[],showSecureElements:e.system.show_secure_cobrowsing_elements,conversationId:olark._.conversationId});olark("api.chat.onCommandFromOperator",function(t){"see"===t.command.name&&h.active()&&(olark._.hlog("#cobrowsing_session_requested"),f.debug(!1),f.share())}),olark._.triggerFireflyDebug=function(){f.debug(!0),f.share()}}})},{}]},{},[1]);}).call(this);